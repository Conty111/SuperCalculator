# build stage
FROM golang:1.22 as builder

RUN mkdir /src
WORKDIR /src

COPY ./back-end/models ./back-end/models
COPY ./back-end/orkestrator ./back-end/orkestrator
COPY ./back-end/proto ./back-end/proto
COPY ./system_config_docker.json system_config.json
COPY go.mod .
COPY go.sum .

#COPY enviroments/.env .
#COPY enviroments/kafka.env .
#COPY enviroments/orkestrator.env .
COPY Makefile .

RUN make build-orkestrator

# production stage
FROM alpine:3.19.1

#COPY --from=builder /src/.env .
#COPY --from=builder /src/kafka.env .
#COPY --from=builder /src/orkestrator.env .
COPY --from=builder /src/orkestrator_app app
COPY --from=builder /src/system_config.json .

RUN apk update && apk upgrade
RUN apk add musl-dev && apk add libc6-compat
RUN chmod +x app
