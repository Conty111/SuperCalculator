# File-svc

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Go Report Card](https://goreportcard.com/badge/github.com/wajox/gobase)](https://goreportcard.com/report/github.com/wajox/gobase)
[![Go Reference](https://pkg.go.dev/badge/github.com/wajox/gobase.svg)](https://pkg.go.dev/github.com/wajox/gobase)
[![codecov](https://codecov.io/gh/wajox/gobase/branch/master/graph/badge.svg?token=0K79C2LH2K)](https://codecov.io/gh/wajox/gobase)
[![Build Status](https://travis-ci.org/wajox/gobase.svg?branch=master)](https://travis-ci.org/wajox/gobase)
[![Mentioned in Awesome Go](https://awesome.re/mentioned-badge.svg)](https://github.com/avelino/awesome-go)

Файловый сервис, работающий с MongoDB GridFS. 
Позволяет загружать, скачивать и удалять файлы. 
Все эндпоинты защищены аутентификацией по JWT-токенам.

## Quick start

1. Если остутствует MongoDB, то спуститься ниже для его установки
2. Должен быть установлен Golang
3. Установить зависимости
   ```
    make install-tools
    go mod tidy
   ```
4. Если нет сервиса аутентификации для генерации ключей для JWT, можно сгенерировать самим:
   1. Установить openssl 

    ```
    sudo apt-get install gnupg curl

    curl -fsSL https://www.mongodb.org/static/pgp/server-7.0.asc | \
      sudo gpg -o /usr/share/keyrings/mongodb-server-7.0.gpg \
      --dearmor
    ```
    2. Сгенерировать пару ключей
    ```
   make gen-jwt-keys
   ```
   Далее можно заменить содержание публичного ключа на то, 
которое нужно (в соответствии с алгоритмом)
5. Запустить приложение
   ```
   make run
   ```


### MongoDB installing
Для Debian дистрибутивов:
```
    sudo apt-get install gnupg curl
    
    curl -fsSL https://www.mongodb.org/static/pgp/server-7.0.asc | \
    sudo gpg -o /usr/share/keyrings/mongodb-server-7.0.gpg \
    --dearmor

    echo "deb [ signed-by=/usr/share/keyrings/mongodb-server-7.0.gpg ] http://repo.mongodb.org/apt/debian bullseye/mongodb-org/7.0 main" | sudo tee /etc/apt/sources.list.d/mongodb-org-7.0.list

    sudo apt-get update -y

    sudo wget http://archive.ubuntu.com/ubuntu/pool/main/o/openssl/libssl1.1_1.1.1f-1ubuntu2_amd64.deb
    sudo dpkg -i libssl1.1_1.1.1f-1ubuntu2_amd64.deb

    sudo apt-get install -y mongodb-org

    sudo systemctl start mongod
    
    sudo systemctl enable mongod # Для автозапуска mongodb
```
    

## Structure

* /api - OpenAPI specs, documentation generated by swag
* /cmd - apps
* /db - database migrations and seeds
* /docs - documentation
* /internal - application sources for internal usage
* /pkg - application sources for external usage(SDK and libraries)
* /test - some stuff for testing purposes

## Commands
```sh
# install dev tools(wire, golangci-lint, swag, ginkgo)
make install-tools

# start test environment from docker-compose-test.yml
make start-docker-compose-test

# stop test environment from docker-compose-test.yml
make stop-docker-compose-test

# build application
make build

# run all tests
make test-all

# run go generate
make gen

# generate OpenAPI docs with swag
make swagger

# generate source code from .proto files
make proto

# generate dependencies with wire
make deps
```

## Tools and packages
* gin-gonic
* ginkgo with gomega
* spf13/viper
* spf13/cobra
* envy
* zerolog
* golangci-lint
* wire
* swag
* migrate
* protoc
* jsonapi
* docker with docker-compose
* openssl
